"use strict";var app=angular.module("angNewsApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase"]).constant("FIREBASE_URL","https://intense-fire-4391.firebaseio.com/");app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/posts.html",controller:"PostsCtrl"}).when("/posts/:postId",{templateUrl:"views/showpost.html",controller:"PostViewCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("PostsCtrl",["$scope","Post",function(a,b){a.post={url:"http://",title:""},a.posts=b.all,a.deletePost=function(a){b.delete(a)}}]),app.controller("PostViewCtrl",["$scope","$routeParams","Post",function(a,b,c){a.post=c.find(b.postId)}]),app.controller("NavCtrl",["$scope","$location","Post","Auth",function(a,b,c,d){a.post={url:"http://",title:""},a.submitPost=function(){c.create(a.post).then(function(c){b.path("posts/"+c.name()),a.post={url:"http://",title:""}})},a.logout=function(){d.logout()}}]),app.factory("Post",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b+"posts"),d=a(c),e={all:d,create:function(a){return d.$add(a)},find:function(a){return d.$child(a)},"delete":function(a){return d.$remove(a)}};return e}]),app.filter("hostnameFromUrl",function(){return function(a){var b=document.createElement("a");return b.href=a,b.hostname}}),app.controller("AuthCtrl",["$scope","$location","Auth","User",function(a,b,c,d){c.signedIn()&&b.path("/"),a.$on("firebaseSimpleLogin:login",function(){b.path("/")}),a.login=function(){c.login(a.user).then(function(){b.path("/")},function(b){a.error=b.toString()})},a.register=function(){c.register(a.user).then(function(c){d.create(c,a.user.username),b.path("/")},function(b){a.error=b.toString()})}}]),app.factory("Auth",["$firebaseSimpleLogin","FIREBASE_URL","$rootScope",function(a,b,c){var d=new Firebase(b),e=a(d),f={register:function(a){return e.$createUser(a.email,a.password)},signedIn:function(){return null!==e.user},login:function(a){return e.$login("password",a)},logout:function(){e.$logout()}};return c.signedIn=function(){return f.signedIn()},f}]),app.factory("User",["$firebase","FIREBASE_URL","Auth","$rootScope",function(a,b,c,d){function e(a){d.currentUser=h.findByUsername(a)}var f=new Firebase(b+"users"),g=a(f),h={create:function(a,b){g[b]={md5_hash:a.md5_hash,username:b,$priority:a.uid},g.$save(b).then(function(){e(b)})},findByUsername:function(a){return a?g.$child(a):void 0},getCurrent:function(){return d.currentUser},signedIn:function(){return void 0!==d.currentUser}};return d.$on("$firebaseSimpleLogin:login",function(b,c){var d=a(f.startAt(c.uid).endAt(c.uid));d.$on("loaded",function(){e(d.$getIndex()[0])})}),h}]),$rootScope.$on("$firebaseSimpleLogin:logout",function(){delete $rootScope.currentUser});